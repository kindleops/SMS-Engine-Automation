services:
  - type: web
    name: rei-sms-engine
    env: python
    plan: free
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn sms.main:app --host 0.0.0.0 --port 10000
    envVars:
      - key: AIRTABLE_API_KEY
        sync: false
      - key: AIRTABLE_LEADS_CONVOS_BASE_ID
        sync: false
      - key: AIRTABLE_CAMPAIGN_CONTROL_BASE_ID
        sync: false
      - key: AIRTABLE_PERFORMANCE_BASE_ID
        sync: false
      - key: TEXTGRID_API_KEY
        sync: false
      - key: TEXTGRID_CAMPAIGN_ID
        sync: false
      - key: CRON_TOKEN
        sync: false

cronjobs:
  # ðŸš€ Outbound batches (3x daily across campaigns)
  - name: send-batch-1
    schedule: "0 15 * * *" # 10 AM CST
    command: |
      curl -X POST "https://rei-sms-engine.onrender.com/send" \
        -H "x-cron-token: $CRON_TOKEN"

  - name: send-batch-2
    schedule: "0 19 * * *" # 2 PM CST
    command: |
      curl -X POST "https://rei-sms-engine.onrender.com/send" \
        -H "x-cron-token: $CRON_TOKEN"

  - name: send-batch-3
    schedule: "0 23 * * *" # 6 PM CST
    command: |
      curl -X POST "https://rei-sms-engine.onrender.com/send" \
        -H "x-cron-token: $CRON_TOKEN"

  # ðŸ”„ Autoresponder (always on, every 10 min)
  - name: run-autoresponder
    schedule: "*/10 * * * *"
    command: |
      curl -X POST "https://rei-sms-engine.onrender.com/autoresponder" \
        -H "x-cron-token: $CRON_TOKEN"

  # Update metrics every 30 minutes
  - name: update-metrics
    schedule: "*/30 * * * *" # every 30 minutes
    command: |
      curl -X POST https://rei-sms-engine.onrender.com/metrics \
        -H "x-cron-token: $CRON_TOKEN"

    # ðŸ”„ Retry runner â€” every 30 minutes
  - type: cron
    name: sms-retry-runner
    schedule: "*/30 * * * *"
    env: python
    buildCommand: ""
    startCommand: >
      curl -sS -X POST
      -H "X-Cron-Token: $CRON_TOKEN"
      https://rei-sms-engine.onrender.com/retry
